<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç«¶è¼ªäºˆæƒ³ãƒœãƒ¼ãƒ‰ï¼ˆ9è»Šãƒ»ã‚°ãƒ«ãƒ¼ãƒ—1ã€œ5ï¼‹ãƒ¡ãƒ¢ä»˜ãï¼‹ãƒãƒ³ã‚¯ç‰¹å¾´ï¼‰</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      margin-bottom: 5px;
      font-size: 22px;
      font-weight: 900;
    }

    /* ä½œè€…ãƒªãƒ³ã‚¯è¡¨ç¤º */
    .author-box {
      margin-bottom: 15px;
      padding: 6px 12px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .author-box a {
      color: #1d9bf0;
      font-weight: bold;
      text-decoration: none;
    }
    .author-box a:hover {
      text-decoration: underline;
    }

    /* â–¼ ãƒãƒ³ã‚¯æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ */
    .bank-box {
      margin-bottom: 10px;
      padding: 8px 10px;
      background: #ffffff;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      box-sizing: border-box;
    }
    .bank-box label {
      font-size: 14px;
      font-weight: 600;
    }
    .bank-box select {
      font-size: 14px;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      min-width: 160px;
    }
    .bank-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 12px;
      flex: 1 1 auto;
    }
    .bank-name-display {
      font-weight: 700;
    }
    .bank-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #999;
      margin-right: 4px;
    }
    /* â–² ãƒãƒ³ã‚¯æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ */

    .controls {
      margin-bottom: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #fff;
      cursor: pointer;
      font-size: 12px;
    }
    .btn:hover { background: #eee; }

    .btn-size-active {
      background: #333;
      color: #fff;
    }

    .btn-group-active {
      background: #005bbb;
      color: #fff;
    }

    .board-wrapper {
      width: 1200px;
      height: 700px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .label {
      font-size: 26px;
      font-weight: 900;
      letter-spacing: 2px;
      color: white;
      -webkit-text-stroke: 2px black;
      margin: 4px 0;
      user-select: none;
    }

    .track {
      position: relative;
      width: 1140px;
      height: 570px;
      background-image: url("bank.jpg");
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #2f6b2f;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    .rider {
      position: absolute;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      border: 2px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: grab;
      user-select: none;
      touch-action: none;
      box-sizing: border-box;
      z-index: 3;
      transition: box-shadow 0.1s;
    }
    .rider:active { cursor: grabbing; }

    /* Shifté¸æŠ */
    .rider.selected {
      box-shadow: 0 0 0 3px rgba(255,0,0,0.6);
    }

    /* ã‚°ãƒ«ãƒ¼ãƒ—æ è‰² */
    .rider[data-group="1"] { box-shadow: 0 0 0 3px rgba(0,120,255,0.7); }
    .rider[data-group="2"] { box-shadow: 0 0 0 3px rgba(0,200,0,0.7); }
    .rider[data-group="3"] { box-shadow: 0 0 0 3px rgba(255,140,0,0.7); }
    .rider[data-group="4"] { box-shadow: 0 0 0 3px rgba(160,80,255,0.7); }
    .rider[data-group="5"] { box-shadow: 0 0 0 3px rgba(255,0,120,0.7); }

    /* è»Šç•ªè‰²ï¼‹åˆæœŸä½ç½® */
    .r1 { background:#fff;    color:#000; top:105px; left:570px; }
    .r2 { background:#000;    color:#fff; top:150px; left:705px; }
    .r3 { background:#ff4d4d; color:#000; top:225px; left:780px; }
    .r4 { background:#4d79ff; color:#000; top:308px; left:780px; }
    .r5 { background:#ffe44d; color:#000; top:383px; left:705px; }
    .r6 { background:#4dff4d; color:#000; top:428px; left:570px; }
    .r7 { background:#ff9933; color:#000; top:383px; left:435px; }
    .r8 { background:#ff66cc; color:#000; top:308px; left:360px; }
    .r9 { background:#b366ff; color:#000; top:225px; left:360px; }

    .hint {
      margin-top: 10px;
      font-size: 13px;
      color: #555;
      text-align: center;
      line-height: 1.6;
    }

    /* ãƒ¡ãƒ¢æ¬„ */
    .memo-wrapper {
      margin-top: 16px;
      width: 100%;
      max-width: 1200px;
    }
    .memo-title {
      font-size: 14px;
      margin-bottom: 4px;
      font-weight: 600;
    }
    #memo {
      width: 100%;
      min-height: 120px;
      padding: 8px;
      font-size: 13px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    .memo-buttons {
      margin-top: 4px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>

  <h1>ç«¶è¼ª äºˆæƒ³ãƒœãƒ¼ãƒ‰ï¼ˆ9è»Šï¼‰</h1>

  <!-- ä½œè€…Xãƒªãƒ³ã‚¯ -->
  <div class="author-box">
    ğŸ‰ ä½œè€…Xï¼ˆTwitterï¼‰ï¼š
    <a href="https://x.com/kumatarou_kuma_" target="_blank">@kumatarou_kuma_</a>
  </div>

  <!-- â–¼ ç«¶è¼ªå ´é¸æŠï¼‹ç‰¹å¾´è¡¨ç¤º -->
  <div class="bank-box">
    <label for="bank-select">ãƒãƒ³ã‚¯ï¼š</label>
    <select id="bank-select">
      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>

      <!-- åŒ—æ—¥æœ¬ -->
      <optgroup label="åŒ—æ—¥æœ¬">
        <option value="hakodate">å‡½é¤¨</option>
        <option value="aomori">é’æ£®</option>
        <option value="iwakidaira">ã„ã‚ãå¹³</option>
      </optgroup>

      <!-- é–¢æ± -->
      <optgroup label="é–¢æ±">
        <option value="yahiko">å¼¥å½¦</option>
        <option value="maebashi">å‰æ©‹</option>
        <option value="toride">å–æ‰‹</option>
        <option value="utsunomiya">å®‡éƒ½å®®</option>
        <option value="omiya">å¤§å®®</option>
        <option value="seibuen">è¥¿æ­¦åœ’</option>
        <option value="keio">äº¬ç‹é–£</option>
        <option value="tachikawa">ç«‹å·</option>
      </optgroup>

      <!-- å—é–¢æ± -->
      <optgroup label="å—é–¢æ±">
        <option value="matsudo">æ¾æˆ¸</option>
        <option value="chiba">åƒè‘‰ï¼ˆ250ï¼‰</option>
        <option value="kawasaki">å·å´</option>
        <option value="hiratsuka">å¹³å¡š</option>
        <option value="odawara">å°ç”°åŸ</option>
        <option value="ito">ä¼Šæ±</option>
        <option value="shizuoka">é™å²¡</option>
      </optgroup>

      <!-- ä¸­éƒ¨ -->
      <optgroup label="ä¸­éƒ¨">
        <option value="nagoya">åå¤å±‹</option>
        <option value="gifu">å²é˜œ</option>
        <option value="ogaki">å¤§å£</option>
        <option value="toyohashi">è±Šæ©‹</option>
        <option value="toyama">å¯Œå±±</option>
        <option value="matsusaka">æ¾é˜ª</option>
        <option value="yokkaichi">å››æ—¥å¸‚</option>
      </optgroup>

      <!-- è¿‘ç•¿ -->
      <optgroup label="è¿‘ç•¿">
        <option value="fukui">ç¦äº•</option>
        <option value="nara">å¥ˆè‰¯</option>
        <option value="muko">å‘æ—¥ç”º</option>
        <option value="wakayama">å’Œæ­Œå±±</option>
        <option value="kishiwada">å²¸å’Œç”°</option>
      </optgroup>

      <!-- ä¸­å›½ -->
      <optgroup label="ä¸­å›½">
        <option value="tamano">ç‰é‡</option>
        <option value="hiroshima">åºƒå³¶</option>
        <option value="hofu">é˜²åºœ</option>
      </optgroup>

      <!-- å››å›½ -->
      <optgroup label="å››å›½">
        <option value="takamatsu">é«˜æ¾</option>
        <option value="komatsushima">å°æ¾å³¶</option>
        <option value="kochi">é«˜çŸ¥</option>
        <option value="matsuyama">æ¾å±±</option>
      </optgroup>

      <!-- ä¹å· -->
      <optgroup label="ä¹å·">
        <option value="kokura">å°å€‰</option>
        <option value="kurume">ä¹…ç•™ç±³</option>
        <option value="takeo">æ­¦é›„</option>
        <option value="sasebo">ä½ä¸–ä¿</option>
        <option value="beppu">åˆ¥åºœ</option>
        <option value="kumamoto">ç†Šæœ¬</option>
      </optgroup>
    </select>

    <div class="bank-info">
      <div class="bank-name-display" id="bank-name-display">ãƒãƒ³ã‚¯æœªé¸æŠ</div>
      <div id="bank-type-display">
        <span class="bank-tag">ã‚¿ã‚¤ãƒ— -</span>
      </div>
      <div id="bank-feature-display">ç‰¹å¾´ï¼š-</div>
    </div>
  </div>
  <!-- â–² ç«¶è¼ªå ´é¸æŠï¼‹ç‰¹å¾´è¡¨ç¤º -->

  <div class="controls">
    <button class="btn" id="resetBtn">åˆæœŸä½ç½®ã«æˆ»ã™</button>
    <button class="btn" id="clearSelectionBtn">ãƒ©ã‚¤ãƒ³é¸æŠè§£é™¤</button>

    <button class="btn btn-size btn-size-active" data-size="small">ä¸¸ å°</button>
    <button class="btn btn-size" data-size="medium">ä¸¸ ä¸­</button>
    <button class="btn btn-size" data-size="large">ä¸¸ å¤§</button>

    <button class="btn group-mode-btn" data-group="1">G1</button>
    <button class="btn group-mode-btn" data-group="2">G2</button>
    <button class="btn group-mode-btn" data-group="3">G3</button>
    <button class="btn group-mode-btn" data-group="4">G4</button>
    <button class="btn group-mode-btn" data-group="5">G5</button>
    <button class="btn" id="clearGroupsBtn">å…¨è§£é™¤</button>
  </div>

  <div class="label">BACK</div>

  <div class="board-wrapper">
    <div class="track" id="track">
      <div class="rider r1">1</div>
      <div class="rider r2">2</div>
      <div class="rider r3">3</div>
      <div class="rider r4">4</div>
      <div class="rider r5">5</div>
      <div class="rider r6">6</div>
      <div class="rider r7">7</div>
      <div class="rider r8">8</div>
      <div class="rider r9">9</div>
    </div>
  </div>

  <div class="label">HOME</div>

  <div class="hint">
    â— G1ã€œG5 â†’ ã‚¿ãƒƒãƒ—ã§æ‰€å±å¤‰æ›´<br>
    â— ã‚°ãƒ«ãƒ¼ãƒ—ã«å…¥ã£ãŸä¸¸ã¯ã¾ã¨ã‚ã¦ç§»å‹•<br>
    â— ãƒ‰ãƒ©ãƒƒã‚°å¾Œã®èª¤ã‚¿ãƒƒãƒ—ã¯è‡ªå‹•ã§ç„¡åŠ¹åŒ–ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã¯å‹æ‰‹ã«å¤‰ã‚ã‚‰ãªã„ï¼‰
  </div>

  <!-- ãƒ¡ãƒ¢æ¬„ -->
  <div class="memo-wrapper">
    <div class="memo-title">ğŸ“ ãƒ¡ãƒ¢ï¼ˆã“ã®ç«¯æœ«ã ã‘ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼‰</div>
    <textarea id="memo" placeholder="ãƒ©ã‚¤ãƒ³æ§‹æˆã€å±•é–‹äºˆæƒ³ã€ã‚³ãƒ¡ãƒ³ãƒˆãªã©è‡ªç”±ã«ãƒ¡ãƒ¢ã§ãã¾ã™ã€‚"></textarea>
    <div class="memo-buttons">
      <button class="btn" id="saveMemoBtn">ãƒ¡ãƒ¢ã‚’ä¿å­˜</button>
      <button class="btn" id="clearMemoBtn">ãƒ¡ãƒ¢ã‚’æ¶ˆå»</button>
    </div>
  </div>

<script>
(function () {
  const track = document.getElementById("track");
  const riders = Array.from(document.querySelectorAll(".rider"));
  const resetBtn = document.getElementById("resetBtn");
  const clearSelectionBtn = document.getElementById("clearSelectionBtn");
  const sizeButtons = Array.from(document.querySelectorAll(".btn-size"));
  const groupButtons = Array.from(document.querySelectorAll(".group-mode-btn"));
  const clearGroupsBtn = document.getElementById("clearGroupsBtn");

  const memo = document.getElementById("memo");
  const saveMemoBtn = document.getElementById("saveMemoBtn");
  const clearMemoBtn = document.getElementById("clearMemoBtn");
  const MEMO_KEY = "keirin-board-memo-v1";

  /* â–¼ ãƒãƒ³ã‚¯é–¢é€£DOM */
  const bankSelect        = document.getElementById("bank-select");
  const bankNameDisplay   = document.getElementById("bank-name-display");
  const bankTypeDisplay   = document.getElementById("bank-type-display");
  const bankFeatureDisplay= document.getElementById("bank-feature-display");
  /* â–² ãƒãƒ³ã‚¯é–¢é€£DOM */

  let isDragging = false;
  let dragItems = [];
  let startX = 0;
  let startY = 0;
  let didDrag = false;   // ãƒ‰ãƒ©ãƒƒã‚°å¾Œã®èª¤ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢

  const BASE_SIZE = 52;
  let currentGroupMode = null;

  /* â–¼ å…¨ãƒãƒ³ã‚¯ãƒã‚¹ã‚¿ */
  const bankMaster = {
    // åŒ—æ—¥æœ¬
    hakodate:  { name: "å‡½é¤¨",   fullName: "å‡½é¤¨ç«¶è¼ªå ´",     region: "åŒ—æ—¥æœ¬", length: 400 },
    aomori:    { name: "é’æ£®",   fullName: "é’æ£®ç«¶è¼ªå ´",     region: "åŒ—æ—¥æœ¬", length: 400 },
    iwakidaira:{ name: "ã„ã‚ãå¹³", fullName: "ã„ã‚ãå¹³ç«¶è¼ªå ´", region: "åŒ—æ—¥æœ¬", length: 400 },

    // é–¢æ±
    yahiko:    { name: "å¼¥å½¦",   fullName: "å¼¥å½¦ç«¶è¼ªå ´",     region: "é–¢æ±",   length: 400 },
    maebashi:  { name: "å‰æ©‹",   fullName: "å‰æ©‹ç«¶è¼ªå ´",     region: "é–¢æ±",   length: 335 },
    toride:    { name: "å–æ‰‹",   fullName: "å–æ‰‹ç«¶è¼ªå ´",     region: "é–¢æ±",   length: 400 },
    utsunomiya:{ name: "å®‡éƒ½å®®", fullName: "å®‡éƒ½å®®ç«¶è¼ªå ´",   region: "é–¢æ±",   length: 500 },
    omiya:     { name: "å¤§å®®",   fullName: "å¤§å®®ç«¶è¼ªå ´",     region: "é–¢æ±",   length: 500 },
    seibuen:   { name: "è¥¿æ­¦åœ’", fullName: "è¥¿æ­¦åœ’ç«¶è¼ªå ´",   region: "é–¢æ±",   length: 400 },
    keio:      { name: "äº¬ç‹é–£", fullName: "äº¬ç‹é–£ç«¶è¼ªå ´",   region: "é–¢æ±",   length: 400 },
    tachikawa: { name: "ç«‹å·",   fullName: "ç«‹å·ç«¶è¼ªå ´",     region: "é–¢æ±",   length: 400 },

    // å—é–¢æ±
    matsudo:   { name: "æ¾æˆ¸",   fullName: "æ¾æˆ¸ç«¶è¼ªå ´",     region: "å—é–¢æ±", length: 333 },
    chiba:     { name: "åƒè‘‰",   fullName: "åƒè‘‰ç«¶è¼ªå ´ï¼ˆPIST6ï¼‰", region: "å—é–¢æ±", length: 250 },
    kawasaki:  { name: "å·å´",   fullName: "å·å´ç«¶è¼ªå ´",     region: "å—é–¢æ±", length: 400 },
    hiratsuka: { name: "å¹³å¡š",   fullName: "å¹³å¡šç«¶è¼ªå ´",     region: "å—é–¢æ±", length: 400 },
    odawara:   { name: "å°ç”°åŸ", fullName: "å°ç”°åŸç«¶è¼ªå ´",   region: "å—é–¢æ±", length: 333 },
    ito:       { name: "ä¼Šæ±",   fullName: "ä¼Šæ±æ¸©æ³‰ç«¶è¼ªå ´", region: "å—é–¢æ±", length: 333 },
    shizuoka:  { name: "é™å²¡",   fullName: "é™å²¡ç«¶è¼ªå ´",     region: "å—é–¢æ±", length: 400 },

    // ä¸­éƒ¨
    nagoya:    { name: "åå¤å±‹", fullName: "åå¤å±‹ç«¶è¼ªå ´",   region: "ä¸­éƒ¨",   length: 400 },
    gifu:      { name: "å²é˜œ",   fullName: "å²é˜œç«¶è¼ªå ´",     region: "ä¸­éƒ¨",   length: 400 },
    ogaki:     { name: "å¤§å£",   fullName: "å¤§å£ç«¶è¼ªå ´",     region: "ä¸­éƒ¨",   length: 400 },
    toyohashi: { name: "è±Šæ©‹",   fullName: "è±Šæ©‹ç«¶è¼ªå ´",     region: "ä¸­éƒ¨",   length: 400 },
    toyama:    { name: "å¯Œå±±",   fullName: "å¯Œå±±ç«¶è¼ªå ´",     region: "ä¸­éƒ¨",   length: 333 },
    matsusaka: { name: "æ¾é˜ª",   fullName: "æ¾é˜ªç«¶è¼ªå ´",     region: "ä¸­éƒ¨",   length: 400 },
    yokkaichi: { name: "å››æ—¥å¸‚", fullName: "å››æ—¥å¸‚ç«¶è¼ªå ´",   region: "ä¸­éƒ¨",   length: 400 },

    // è¿‘ç•¿
    fukui:     { name: "ç¦äº•",   fullName: "ç¦äº•ç«¶è¼ªå ´",     region: "è¿‘ç•¿",   length: 400 },
    nara:      { name: "å¥ˆè‰¯",   fullName: "å¥ˆè‰¯ç«¶è¼ªå ´",     region: "è¿‘ç•¿",   length: 333 },
    muko:      { name: "å‘æ—¥ç”º", fullName: "å‘æ—¥ç”ºç«¶è¼ªå ´",   region: "è¿‘ç•¿",   length: 400 },
    wakayama:  { name: "å’Œæ­Œå±±", fullName: "å’Œæ­Œå±±ç«¶è¼ªå ´",   region: "è¿‘ç•¿",   length: 400 },
    kishiwada: { name: "å²¸å’Œç”°", fullName: "å²¸å’Œç”°ç«¶è¼ªå ´",   region: "è¿‘ç•¿",   length: 400 },

    // ä¸­å›½
    tamano:    { name: "ç‰é‡",   fullName: "ç‰é‡ç«¶è¼ªå ´",     region: "ä¸­å›½",   length: 400 },
    hiroshima: { name: "åºƒå³¶",   fullName: "åºƒå³¶ç«¶è¼ªå ´",     region: "ä¸­å›½",   length: 400 },
    hofu:      { name: "é˜²åºœ",   fullName: "é˜²åºœç«¶è¼ªå ´",     region: "ä¸­å›½",   length: 333 },

    // å››å›½
    takamatsu:    { name: "é«˜æ¾",   fullName: "é«˜æ¾ç«¶è¼ªå ´",     region: "å››å›½",   length: 400 },
    komatsushima: { name: "å°æ¾å³¶", fullName: "å°æ¾å³¶ç«¶è¼ªå ´",   region: "å››å›½",   length: 400 },
    kochi:        { name: "é«˜çŸ¥",   fullName: "é«˜çŸ¥ç«¶è¼ªå ´",     region: "å››å›½",   length: 500 },
    matsuyama:    { name: "æ¾å±±",   fullName: "æ¾å±±ç«¶è¼ªå ´",     region: "å››å›½",   length: 400 },

    // ä¹å·
    kokura:   { name: "å°å€‰",   fullName: "å°å€‰ç«¶è¼ªå ´",     region: "ä¹å·",   length: 400 },
    kurume:   { name: "ä¹…ç•™ç±³", fullName: "ä¹…ç•™ç±³ç«¶è¼ªå ´",   region: "ä¹å·",   length: 400 },
    takeo:    { name: "æ­¦é›„",   fullName: "æ­¦é›„ç«¶è¼ªå ´",     region: "ä¹å·",   length: 400 },
    sasebo:   { name: "ä½ä¸–ä¿", fullName: "ä½ä¸–ä¿ç«¶è¼ªå ´",   region: "ä¹å·",   length: 400 },
    beppu:    { name: "åˆ¥åºœ",   fullName: "åˆ¥åºœç«¶è¼ªå ´",     region: "ä¹å·",   length: 400 },
    kumamoto: { name: "ç†Šæœ¬",   fullName: "ç†Šæœ¬ç«¶è¼ªå ´",     region: "ä¹å·",   length: 400 }
  };

  const lengthProfiles = {
    333: {
      tag: "33ãƒãƒ³ã‚¯",
      type: "å…ˆè¡Œãƒ»é€ƒã’æœ‰åˆ©",
      feature: "ã‚³ãƒ¼ãƒŠãƒ¼ãŒå¤šãç›´ç·šãŒçŸ­ã‚ã€‚é€ƒã’ãƒ»å…ˆè¡Œã®æŠ¼ã—åˆ‡ã‚Šã‚„æ³¢ä¹±ã‚‚å‡ºã‚„ã™ã„ãƒãƒ³ã‚¯ã€‚"
    },
    335: {
      tag: "335ãƒãƒ³ã‚¯",
      type: "ã‚«ãƒ³ãƒˆå¼·ã‚ã®è‡ªåŠ›å‹è² ",
      feature: "ã‚«ãƒ³ãƒˆãŒãã¤ã‚ã§è¸ã¿ç›´ã—ãŒåˆ©ãã‚¿ã‚¤ãƒ—ã€‚è‡ªåŠ›å‹ã®è¸ã¿åˆã„ã«ãªã‚Šã‚„ã™ã„ã€‚"
    },
    400: {
      tag: "400ãƒãƒ³ã‚¯",
      type: "æ¨™æº–çš„ãªãƒãƒ©ãƒ³ã‚¹å‹",
      feature: "å…¨å›½æ¨™æº–ã®è·é›¢ã§ã‚¯ã‚»ãŒå°‘ãªã„ã€‚ãƒ©ã‚¤ãƒ³æ±ºç€ãƒ»ç•ªæ‰‹å·®ã—ãƒ»æ²ã‚ŠãŒãƒãƒ©ãƒ³ã‚¹ã‚ˆãæ±ºã¾ã‚Šã‚„ã™ã„ã€‚"
    },
    500: {
      tag: "500ãƒãƒ³ã‚¯",
      type: "ç›´ç·šé•·ã‚ãƒ»å·®ã—å¯„ã‚Š",
      feature: "ç›´ç·šãŒé•·ãã€é€ƒã’æ®‹ã‚Šã‚ˆã‚Šã‚‚æ²ã‚Šãƒ»å·®ã—ãŒå±Šãã‚„ã™ã„å‚¾å‘ã®ãƒ­ãƒ³ã‚°ãƒãƒ³ã‚¯ã€‚"
    },
    250: {
      tag: "250æœ¨è£½ãƒ‰ãƒ¼ãƒ ",
      type: "ã‚¹ãƒ—ãƒªãƒ³ãƒˆç‰¹åŒ–",
      feature: "åƒè‘‰ã®å±‹å†…æœ¨è£½ãƒãƒ³ã‚¯ã€‚å‘¨é•·ãŒçŸ­ãå‘¨å›æ•°ãŒå¤šã„ã‚¹ãƒ—ãƒªãƒ³ãƒˆå¿—å‘ã®ãƒ¬ãƒ¼ã‚¹ãŒä¸­å¿ƒã€‚"
    }
  };
  /* â–² å…¨ãƒãƒ³ã‚¯ãƒã‚¹ã‚¿ */

  window.addEventListener("load", () => {
    riders.forEach(r => {
      const cs = getComputedStyle(r);
      r.dataset.initLeft = cs.left;
      r.dataset.initTop = cs.top;
    });
    applySize("small");

    const saved = localStorage.getItem(MEMO_KEY);
    if (saved !== null) {
      memo.value = saved;
    }
  });

  function applySize(mode) {
    let scale;
    if (mode === "small") scale = 0.80;
    else if (mode === "large") scale = 1.25;
    else scale = 1.0;

    const newSize = BASE_SIZE * scale;
    riders.forEach(r => {
      r.style.width = newSize + "px";
      r.style.height = newSize + "px";
      r.style.fontSize = (newSize * 0.5) + "px";
    });

    sizeButtons.forEach(b => b.classList.remove("btn-size-active"));
    const active = sizeButtons.find(b => b.dataset.size === mode);
    if (active) active.classList.add("btn-size-active");
  }

  sizeButtons.forEach(btn => {
    btn.addEventListener("click", () => applySize(btn.dataset.size));
  });

  function updateGroupButtonStates() {
    groupButtons.forEach(btn => {
      btn.classList.toggle("btn-group-active", btn.dataset.group === currentGroupMode);
    });
  }

  groupButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const g = btn.dataset.group;
      currentGroupMode = (currentGroupMode === g ? null : g);
      updateGroupButtonStates();
    });
  });

  clearGroupsBtn.addEventListener("click", () => {
    currentGroupMode = null;
    updateGroupButtonStates();
    riders.forEach(r => delete r.dataset.group);
  });

  function selectedRiders() {
    return riders.filter(r => r.classList.contains("selected"));
  }

  track.addEventListener("click", (e) => {
    if (didDrag) {
      didDrag = false;
      return;
    }

    const r = e.target.closest(".rider");
    if (!r) return;

    if (currentGroupMode) {
      if (r.dataset.group === currentGroupMode) {
        delete r.dataset.group;
      } else {
        r.dataset.group = currentGroupMode;
      }
      return;
    }

    if (e.shiftKey) {
      r.classList.toggle("selected");
    }
  });

  function startDrag(e) {
    const target = e.target.closest(".rider");
    if (!target) return;

    if (!e.touches && e.shiftKey) return;

    isDragging = true;
    didDrag = false;

    const cx = e.touches ? e.touches[0].clientX : e.clientX;
    const cy = e.touches ? e.touches[0].clientY : e.clientY;
    startX = cx;
    startY = cy;

    let group = [];
    const gid = target.dataset.group;

    if (gid) {
      group = riders.filter(r => r.dataset.group === gid);
    } else {
      const sel = selectedRiders();
      group = (sel.length > 0 && sel.includes(target)) ? sel : [target];
    }

    dragItems = group.map(el => {
      const cs = getComputedStyle(el);
      return {
        el,
        startLeft: parseFloat(cs.left),
        startTop: parseFloat(cs.top)
      };
    });
  }

  function moveDrag(e) {
    if (!isDragging || dragItems.length === 0) return;

    const cx = e.touches ? e.touches[0].clientX : e.clientX;
    const cy = e.touches ? e.touches[0].clientY : e.clientY;

    const dx = cx - startX;
    const dy = cy - startY;

    if (Math.abs(dx) > 3 || Math.abs(dy) > 3) {
      didDrag = true;
    }

    const rect = track.getBoundingClientRect();

    dragItems.forEach(item => {
      const el = item.el;
      const maxX = rect.width - el.offsetWidth;
      const maxY = rect.height - el.offsetHeight;

      let left = item.startLeft + dx;
      let top = item.startTop + dy;

      left = Math.max(0, Math.min(maxX, left));
      top = Math.max(0, Math.min(maxY, top));

      el.style.left = left + "px";
      el.style.top = top + "px";
    });

    e.preventDefault();
  }

  function endDrag() {
    isDragging = false;
    dragItems = [];
  }

  function reset() {
    riders.forEach(r => {
      r.style.left = r.dataset.initLeft;
      r.style.top = r.dataset.initTop;
    });
  }

  function clearSelection() {
    riders.forEach(r => r.classList.remove("selected"));
  }

  saveMemoBtn.addEventListener("click", () => {
    localStorage.setItem(MEMO_KEY, memo.value);
  });

  clearMemoBtn.addEventListener("click", () => {
    memo.value = "";
    localStorage.removeItem(MEMO_KEY);
  });

  track.addEventListener("mousedown", startDrag);
  window.addEventListener("mousemove", moveDrag);
  window.addEventListener("mouseup", endDrag);

  track.addEventListener("touchstart", startDrag, { passive:false });
  window.addEventListener("touchmove", moveDrag, { passive:false });
  window.addEventListener("touchend", endDrag);
  window.addEventListener("touchcancel", endDrag);

  resetBtn.addEventListener("click", reset);
  clearSelectionBtn.addEventListener("click", clearSelection);

  /* â–¼ ãƒãƒ³ã‚¯é¸æŠã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ */
  function describeBank(bank) {
    const profile = lengthProfiles[bank.length] || {
      tag: "ãƒãƒ³ã‚¯",
      type: "æ¨™æº–",
      feature: "æ¨™æº–çš„ãªãƒãƒ³ã‚¯ã€‚è„šè³ªã‚ˆã‚Šã‚‚èª¿å­ã¨ä½ç½®å–ã‚ŠãŒé‡è¦ã€‚"
    };

    bankNameDisplay.textContent =
      `${bank.fullName}ï¼ˆ${bank.region}ãƒ»${bank.length}mï¼‰`;

    bankTypeDisplay.innerHTML =
      `<span class="bank-tag">${profile.tag}</span>` +
      `<span style="font-size:11px; margin-left:4px;">${profile.type}</span>`;

    bankFeatureDisplay.textContent = "ç‰¹å¾´ï¼š" + profile.feature;

    // ãƒ¡ãƒ¢ãŒç©ºãªã‚‰è‡ªå‹•ã§1è¡Œå…¥ã‚Œã‚‹ï¼ˆã„ã‚‰ãªã‘ã‚Œã°æ¶ˆã—ã¦OKï¼‰
    if (memo && !memo.value.trim()) {
      memo.value =
        `ã€ãƒãƒ³ã‚¯ã€‘${bank.fullName}ï¼ˆ${bank.length}mï¼‰\n` +
        `ç‰¹å¾´ï¼š${profile.feature}\n`;
    }
  }

  bankSelect.addEventListener("change", () => {
    const key = bankSelect.value;
    const bank = bankMaster[key];

    if (!bank) {
      bankNameDisplay.textContent = "ãƒãƒ³ã‚¯æœªé¸æŠ";
      bankTypeDisplay.innerHTML = '<span class="bank-tag">ã‚¿ã‚¤ãƒ— -</span>';
      bankFeatureDisplay.textContent = "ç‰¹å¾´ï¼š-";
      return;
    }

    describeBank(bank);
  });
  /* â–² ãƒãƒ³ã‚¯é¸æŠã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ */

})();
</script>

</body>
</html>
